# Loon 进阶配置
# Date: 2024-03-20 15:30:00
# Author: cances

[General]
ipv6 = true
dns-server = 119.29.29.29,223.5.5.5
# 腾讯DoH和阿里云DoH
doh-server = https://223.5.5.5/dns-query,https://1.12.12.12/dns-query
disable-udp-ports = 443
allow-wifi-access = false
wifi-access-http-port = 7222
wifi-access-socks5-port = 7221
proxy-test-url = http://www.apple.com/library/test/success.html
test-timeout = 2
interface-mode = auto
sni-sniffing = true
disable-stun = false
disconnect-on-policy-change = false
switch-node-after-failure-times = 3
internet-test-url = http://connectivitycheck.platform.hicloud.com/generate_204
proxy-test-url = http://www.apple.com/library/test/success.html
resource-parser = https://gitlab.com/sub-store/Sub-Store/-/releases/permalink/latest/downloads/sub-store-parser.loon.min.js
geoip-url = https://gitlab.com/Masaiki/GeoIP2-CN/-/raw/release/Country.mmdb
skip-proxy = 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, localhost, *.local, e.crashlynatics.com
bypass-tun = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 192.88.99.0/24, 192.168.0.0/16, 198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32

[Proxy]
# https://github.com/UnblockNeteaseMusic/server 服务地址
网易云音乐解锁 = HTTP,114.114.114.114,8080

[Remote Proxy]

[Proxy Group]
# --------------------------------
# 手动选择地区策略
香港策略 = select, 香港延时优选, 香港故障转移, 香港负载均衡, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/HK.png
台湾策略 = select, 台湾延时优选, 台湾故障转移, 台湾负载均衡, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/TW.png
日本策略 = select, 日本延时优选, 日本故障转移, 日本负载均衡, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/JP.png
韩国策略 = select, 韩国延时优选, 韩国故障转移, 韩国负载均衡, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/KR.png
新国策略 = select, 新国延时优选, 新国故障转移, 新国负载均衡, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/SG.png
美国策略 = select, 美国延时优选, 美国故障转移, 美国负载均衡, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/US.png
欧洲策略 = select, 欧洲延时优选, 欧洲故障转移, 欧洲负载均衡, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/UK.png
# --------------------------------
# 自动
# 延时优选
香港延时优选 = url-test, 香港节点, url = http://www.apple.com/library/test/success.html, interval = 60, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/HK.png
台湾延时优选 = url-test, 台湾节点, url = http://www.apple.com/library/test/success.html, interval = 60, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/TW.png
日本延时优选 = url-test, 日本节点, url = http://www.apple.com/library/test/success.html, interval = 60, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/JP.png
韩国延时优选 = url-test, 韩国节点, url = http://www.apple.com/library/test/success.html, interval = 60, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/KR.png
新国延时优选 = url-test, 新国节点, url = http://www.apple.com/library/test/success.html, interval = 60, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/SG.png
美国延时优选 = url-test, 美国节点, url = http://www.apple.com/library/test/success.html, interval = 60, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/US.png
欧洲延时优选 = url-test, 欧洲节点, url = http://www.apple.com/library/test/success.html, interval = 60, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/UK.png
# --------------------------------
# 故障转移
香港故障转移 = fallback, 香港节点, url = http://www.apple.com/library/test/success.html, interval = 60, max-timeout = 3000, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/HK.png
台湾故障转移 = fallback, 台湾节点, url = http://www.apple.com/library/test/success.html, interval = 60, max-timeout = 3000, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/TW.png
日本故障转移 = fallback, 日本节点, url = http://www.apple.com/library/test/success.html, interval = 60, max-timeout = 3000, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/JP.png
韩国故障转移 = fallback, 韩国节点, url = http://www.apple.com/library/test/success.html, interval = 60, max-timeout = 3000, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/KR.png
新国故障转移 = fallback, 新国节点, url = http://www.apple.com/library/test/success.html, interval = 60, max-timeout = 3000, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/SG.png
美国故障转移 = fallback, 美国节点, url = http://www.apple.com/library/test/success.html, interval = 60, max-timeout = 3000, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/US.png
欧洲故障转移 = fallback, 欧洲节点, url = http://www.apple.com/library/test/success.html, interval = 60, max-timeout = 3000, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/UK.png
# --------------------------------
# 负载均衡
香港负载均衡 = load-balance, 香港节点, url = http://www.apple.com/library/test/success.html, interval = 60, max-timeout = 3000, algorithm = pcc, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/HK.png
台湾负载均衡 = load-balance, 台湾节点, url = http://www.apple.com/library/test/success.html, interval = 60, max-timeout = 3000, algorithm = pcc, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/TW.png
日本负载均衡 = load-balance, 日本节点, url = http://www.apple.com/library/test/success.html, interval = 60, max-timeout = 3000, algorithm = pcc, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/JP.png
韩国负载均衡 = load-balance, 韩国节点, url = http://www.apple.com/library/test/success.html, interval = 60, max-timeout = 3000, algorithm = pcc, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/KR.png
新国负载均衡 = load-balance, 新国节点, url = http://www.apple.com/library/test/success.html, interval = 60, max-timeout = 3000, algorithm = pcc, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/SG.png
美国负载均衡 = load-balance, 美国节点, url = http://www.apple.com/library/test/success.html, interval = 60, max-timeout = 3000, algorithm = pcc, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/US.png
欧洲负载均衡 = load-balance, 欧洲节点, url = http://www.apple.com/library/test/success.html, interval = 60, max-timeout = 3000, algorithm = pcc, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/UK.png
# --------------------------------
# 手动
游戏手动 = select, 游戏节点, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/Game.png
全球手动 = select, 全球节点, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/Global.png
解锁节点 = select, 网易解锁, DIRECT, img-url = https://raw.githubusercontent.com/Orz-3/mini/master/Color/Netease.png

[Remote Filter]
游戏节点 = NameRegex, FilterKey = "^(?=.*((?i)游戏|🎮|(\b(GAME)\d{0,2}\b)))(?!.*((?i)回国|校园)).*$"
全球节点 = NameRegex, FilterKey = "^(?=.*(.))(?!.*((?i)群|邀请|返利|循环|官网|客服|网站|网址|获取|订阅|流量|到期|机场|下次|版本|官址|备用|过期|已用|联系|邮箱|工单|贩卖|通知|倒卖|防止|国内|地址|频道|无法|说明|使用|提示|特别|访问|支持|🎮|(\b(GAME|USE|USED|TOTAL|EXPIRE|EMAIL|Panel)\d{0,2}\b|(\d{4}-\d{2}-\d{2}|\dG)))).*$"
香港节点 = NameRegex, FilterKey = "^(?=.*((?i)🇭🇰|香港|(\b(HK|Hong)\d{0,2}\b)))(?!.*((?i)回国|校园|游戏|🎮|(\b(GAME)\b))).*$"
台湾节点 = NameRegex, FilterKey = "^(?=.*((?i)🇹🇼|台湾|(\b(TW|Tai|Taiwan)\d{0,2}\b)))(?!.*((?i)回国|校园|游戏|🎮|(\b(GAME)\b))).*$"
日本节点 = NameRegex, FilterKey = "^(?=.*((?i)🇯🇵|日本|川日|东京|大阪|泉日|埼玉|(\b(JP|Japan)\d{0,2}\b)))(?!.*((?i)回国|校园|游戏|🎮|(\b(GAME)\b))).*$"
韩国节点 = NameRegex, FilterKey = "^(?=.*((?i)🇰🇷|韩国|韓|首尔|(\b(KR|Korea)\d{0,2}\b)))(?!.*((?i)回国|校园|游戏|🎮|(\b(GAME)\b))).*$"
新国节点 = NameRegex, FilterKey = "^(?=.*((?i)🇸🇬|新加坡|狮|(\b(SG|Singapore)\d{0,2}\b)))(?!.*((?i)回国|校园|游戏|🎮|(\b(GAME)\b))).*$"
美国节点 = NameRegex, FilterKey = "^(?=.*((?i)🇺🇸|美国|波特兰|达拉斯|俄勒冈|凤凰城|费利蒙|硅谷|拉斯维加斯|洛杉矶|圣何塞|圣克拉拉|西雅图|芝加哥|(\b(US|United States)\d{0,2}\b)))(?!.*((?i)回国|校园|游戏|🎮|(\b(GAME)\b))).*$"
欧洲节点 = NameRegex, FilterKey = "(?=.*(AL|AD|AR|AM|AT|AZ|BS|BH|BD|BB|BY|BE|BA|BG|BR|BE|BA|BG|HR|CY|CZ|DK|EE|FI|FR|DE|GR|HU|IS|IE|IT|XK|LV|LI|LT|LU|MK|MT|MD|MC|ME|NL|NO|PL|PT|RO|RU|SM|RS|SK|SI|AQ|AU|阿尔巴尼亚|安道尔|阿根廷|亚美尼亚|奥地利|阿塞拜疆|巴哈马|巴林|孟加拉国|巴巴多斯|白俄罗斯|比利时|波黑|保加利亚|巴西|比利时|波黑|保加利亚|克罗地亚|塞浦路斯|捷克|丹麦|爱沙尼亚|芬兰|法国|德国|希腊|匈牙利|冰岛|爱尔兰|意大利|科索沃|拉脱维亚|列支敦士登|立陶宛|卢森堡|北马其顿|马耳他|摩尔多瓦|摩纳哥|黑山|荷兰|挪威|波兰|葡萄牙|罗马尼亚|俄罗斯|圣马力诺|塞尔维亚|斯洛伐克|斯洛文尼亚|南极洲|澳大利亚(?i)Music))^((?!(台|日|韩|新|美|香|加TG|RES|港|HK|主|SG|TW|US|JP|MP|MY|HongKong|ISP|HOME|VLESS|机场|官网|欢迎|返利|每月|流量|到期|更新|时间|订阅|重置|ISP|com|套餐|购买)).)*$"
网易解锁 = NameRegex, FilterKey = "(?i)(unblock|music|Music|云音乐|🎧)"

[Rule]
# Type:DOMAIN-SUFFIX, DOMAIN, DOMAIN-KEYWORD, USER-AGENT, URL-REGEX, IP-CIDR
# Strategy:DIRECT, PROXY, REJECT
# Options:no-resolve(only for cidr)
# IP-CIDR, 192.168.0.0/16, DIRECT
# IP-CIDR, 10.0.0.0/8, DIRECT
# IP-CIDR, 172.16.0.0/12, DIRECT
# IP-CIDR, 127.0.0.0/8, DIRECT
# GEOIP, cn, DIRECT
# IP-CIDR6, 2000::/3, DIRECT
FINAL, 香港策略

[Remote Rule]
https://adrules.top/adrules.list, policy=REJECT-DROP, tag=adrules.list, enabled=true
https://raw.githubusercontent.com/ConnersHua/RuleGo/master/Surge/Ruleset/Extra/Reject/Hijacking.list, policy=REJECT, tag=运营劫持, enabled=true
https://raw.githubusercontent.com/ConnersHua/RuleGo/master/Surge/Ruleset/Extra/Reject/Tracking.list, policy=REJECT, tag=隐私保护, enabled=true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/BlockHttpDNS/BlockHttpDNS.list, policy=REJECT, tag=预防泄漏, enabled=true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/YouTube/YouTube.list, policy=香港策略, tag=YouTube, enabled=true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Telegram/Telegram.list, policy=香港策略, tag=Telegram, enabled=true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/OpenAI/OpenAI.list, policy=新国策略, tag=Open AI, enabled=true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Google/Google.list, policy=新国策略, tag=Google, enabled=true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/GitHub/GitHub.list, policy=香港策略, tag=GitHub, enabled=true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Proxy/Proxy.list, policy=香港策略, tag=Global, enabled=true
https://raw.githubusercontent.com/canc3s/script/loon/Rule/NetEaseMusic.list, policy=解锁节点, tag=NetEaseMusic, enabled=true

[Host]
[Rewrite]

[MITM]
enable = false
skip-server-cert-verify = false